# Database Models Documentation

This directory contains documentation for all MongoDB database models and schemas.

## Core Models

| Model | File | Collection | Purpose |
|-------|------|-----------|---------|
| Booking | [doc/models/Booking.md](./Booking.md) | bookings | Photography session bookings |

## Model Structure

```
server/models/
├── Booking.js
└── [Other models]
```

## Creating New Model Documentation

When creating a new database model:

1. Create a new `.md` file with model name (e.g., `ModelName.md`)
2. Use the [Server Model Template](../../.github/skills/documentation-writer/references/server-model-template.md)
3. Fill in all required sections:
   - Schema Definition with field types
   - Field Definitions (detailed)
   - Indexes and Constraints
   - Validation Rules
   - Example MongoDB Document
   - Relationships to other models
   - CRUD Operations (code examples)
   - Usage in Controllers
   - Related API Endpoints
4. Add the model entry to this README.md

## Core Fields Convention

All models should include these standard fields:

```javascript
{
  _id: ObjectId,              // Auto-generated by MongoDB
  createdAt: Date,            // Auto-set on creation
  updatedAt: Date,            // Auto-set on creation/update
  __v: Number                 // Mongoose versioning
}
```

## Field Types Reference

| Type | Mongoose | JavaScript | Example |
|------|----------|-----------|---------|
| String | String | string | "example text" |
| Number | Number | number | 42, 3.14 |
| Boolean | Boolean | boolean | true, false |
| Date | Date | Date | 2025-02-08T10:30:00Z |
| ObjectId | ObjectId | string | 507f1f77bcf86cd799439011 |
| Array | [Type] | Array | ["item1", "item2"] |
| Enum | String (enum) | string | "value1" or "value2" |

## Common Model Patterns

### Required Fields
```javascript
fieldName: {
  type: String,
  required: true,
  trim: true
}
```

### Optional Fields
```javascript
fieldName: {
  type: String,
  default: null
}
```

### Enum Fields
```javascript
sessionType: {
  type: String,
  enum: ['newborn', 'toddler', 'kids', 'family'],
  required: true
}
```

### Unique Fields
```javascript
email: {
  type: String,
  unique: true,
  lowercase: true,
  required: true
}
```

### Indexed Fields
```javascript
createdAt: {
  type: Date,
  default: Date.now,
  index: true
}
```

### Compound Unique Index
```javascript
// In schema definition
schema.index({ email: 1, preferredDate: 1 }, { unique: true });
```

## Validation Rules

### Built-in Validators
- `required` - Field must have a value
- `unique` - Field value must be unique across documents
- `min` / `max` - Number range
- `minlength` / `maxlength` - String length
- `match` - Regex pattern validation
- `enum` - Must be one of specified values

### Custom Validators
```javascript
fieldName: {
  type: String,
  validate: {
    validator: function(v) {
      return v.length > 3;
    },
    message: 'Field must be longer than 3 characters'
  }
}
```

## Relationships Between Models

### One-to-One (Commenting)
```javascript
// Model A references Model B
{
  _id: "...",
  name: "...",
  relatedModelId: ObjectId("507f...")  // Reference
}
```

### One-to-Many (Commenting)
A user has many bookings:
```javascript
// User document
{ _id: "user-id", name: "John" }

// Booking documents
[
  { _id: "booking-1", userId: "user-id" },
  { _id: "booking-2", userId: "user-id" }
]
```

## CRUD Operations Standard

All models should document:

### Create
```javascript
const newDoc = new ModelName(data);
await newDoc.save();
```

### Read
```javascript
const doc = await ModelName.findById(id);
const docs = await ModelName.find({ field: value });
```

### Update
```javascript
await ModelName.findByIdAndUpdate(id, { field: newValue }, { new: true });
```

### Delete
```javascript
await ModelName.findByIdAndDelete(id);
```

## Controllers Using Models

```
server/controllers/
├── bookingController.js
└── [Other controllers]
```

## Testing Models

Standard Mongoose validation tests:

```javascript
describe('ModelName', () => {
  it('should validate required fields', async () => {
    const doc = new ModelName({});
    await expect(doc.save()).rejects.toThrow();
  });

  it('should enforce unique constraint', async () => {
    const doc1 = new ModelName({ email: "test@example.com" });
    await doc1.save();
    
    const doc2 = new ModelName({ email: "test@example.com" });
    await expect(doc2.save()).rejects.toThrow();
  });
});
```

## Database Connection

**File**: `server/config/db.js`

- Optional for development
- Server continues without DB if connection fails
- Set `MONGODB_URI` in `server/.env` to enable persistence

## Performance Tips

1. **Index frequently queried fields** (e.g., `email`, `createdAt`, `status`)
2. **Use compound indexes** for common multi-field queries
3. **Denormalize data** when joining documents is too expensive
4. **Archive old documents** if collection grows very large
5. **Monitor query performance** with database tools

---

For more information, see the [documentation-writer skill](.github/skills/documentation-writer/SKILL.md).
